const express = require('express');
const cors = require('cors');
const { MongoClient } = require("mongodb");
const openAI = require('openai');
const dotenv = require('dotenv');

dotenv.config();
openai_apiKey = process.env.OPENAI_KEY;

const openai = new openAI.OpenAI({
  apiKey: openai_apiKey,
});

const app = express();
app.use(express.json());
app.use(cors());

// Replace with your MongoDB connection string
const uri = process.env.MONGO_URI;

const client = new MongoClient(uri);
let productColl;

client.connect().then(() => {
    //get collection instance
    productColl = client.db("ecommerce").collection("catalog");
});




app.get('/autocomplete', async (req, res) => {
    const query = req.query.q;
    try {
      const results = await productColl.aggregate([
        {
          $search: {
            index: 'autocomplete',
            autocomplete: {
              query: query,
              path: 'title',
              fuzzy: {
                maxEdits: 2
              }
            }
          }
        },
        {
          $limit: 4
        },
        {
          $project: {
            _id: 1,
            title: 1
          }
        }
      ]).toArray();
      res.json(results);
    } catch (err) {
      res.status(500).json({ message: err.message });
    }
  });



const defaultIndex = {
    $search: {
      index: 'default', // index name
      text: {
        query: "",
        path: ['title', 'description'], // Search in both title and description
        fuzzy: {
            maxEdits: 1
        }
      }
    }
  }


 const project =   {
    $project: {
      _id: 0,
      title: 1,
      description: 1,
      score: { $meta: "searchScore" } // Include search score in the results
    }
  }



// Search endpoint
app.get('/search', async (req, res) => {
  const query = req.query.q;
  try {
    
    //look for results without Atlas Search
    const findResults = await productColl.find({ title: new RegExp(query) }).toArray();

    // look for results with Atlas Search
    defaultIndex.$search.text.query = query;
    const searchResults = await productColl.aggregate([ defaultIndex, project ]).toArray();

    res.json({ findResults, searchResults });
    
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
});

// recommendations endpoint
app.get('/also-recommend', async (req, res) => {
  const vector = req.query.q;
  try {
    const queryVector = [
      0.058561474,
      0.002560881,
      -0.04577926,
      -0.019516546,
      -0.006124811,
      -0.057898693,
      0.016699726,
      0.059745014,
      0.027671127,
      0.024451902,
      -0.012332469,
      0.032902364,
      -0.01451018,
      -0.03337578,
      0.020889452,
      0.05183898,
      -0.013018921,
      -0.016107956,
      -0.034322612,
      0.018321173,
      -0.016036944,
      0.054821495,
      0.021244513,
      -0.007343855,
      0.01699561,
      -0.0018596345,
      0.019682242,
      0.025398733,
      0.069260664,
      -0.0003291716,
      -0.0047726184,
      -0.01945737,
      0.034748685,
      -0.003935265,
      0.017824087,
      0.0097523555,
      -0.054016687,
      -0.0057460787,
      0.005450194,
      0.061023235,
      0.05695186,
      0.013622526,
      0.07432621,
      -0.041755233,
      0.043009784,
      0.007823188,
      0.015172961,
      0.0061721522,
      0.026014172,
      0.01576473,
      0.030677313,
      -0.0014187666,
      0.004414598,
      0.04109245,
      0.0030416935,
      -0.0041127955,
      -0.010012734,
      -0.023990322,
      0.03806259,
      0.04426433,
      -0.022605581,
      -0.0021599573,
      0.019350851,
      0.008462299,
      -0.004240026,
      -0.010876717,
      -0.0018463198,
      0.03155313,
      -0.047507226,
      -0.04516382,
      0.03794424,
      -0.031411108,
      -0.061259944,
      -0.031174399,
      -0.011385638,
      0.041376498,
      -0.019102309,
      -0.0091783395,
      0.038772713,
      0.034654003,
      -0.0028390125,
      0.021741599,
      -0.034109574,
      0.021398373,
      -0.01451018,
      -0.018214654,
      -0.043341175,
      -0.004893931,
      -0.064431824,
      -0.039080434,
      0.06376904,
      -0.025564428,
      0.019528382,
      -0.014616698,
      -0.021504892,
      0.04563724,
      0.0010888552,
      -0.0035239854,
      -0.01617897,
      0.030748324,
      -0.0030002696,
      -0.010060076,
      -0.016900927,
      -0.006021251,
      -0.015823908,
      -0.022084825,
      0.01561087,
      0.016983775,
      -0.025209365,
      0.009758273,
      -0.092789404,
      0.0069000283,
      0.0015903796,
      0.014498345,
      -0.023599753,
      -0.027860492,
      0.028239224,
      -0.027529102,
      0.027363406,
      0.0025697576,
      -0.011646017,
      0.022877796,
      -0.0046720174,
      -0.043057125,
      -0.021055147,
      -0.019599395,
      -0.016545866,
      0.010912223,
      -0.056383766,
      0.00078409415,
      -0.018037124,
      -0.012734872,
      0.07484696,
      -0.002476554,
      -0.020120151,
      -0.040571693,
      -0.01745719,
      -0.009456472,
      0.02253457,
      -0.0058022966,
      -0.007911954,
      -0.026771637,
      0.020498883,
      0.0171258,
      -0.03678437,
      0.04106878,
      0.00076412194,
      0.06817181,
      0.012018831,
      0.040216632,
      -0.019528382,
      0.011320544,
      -0.028807323,
      0.023505071,
      0.007201831,
      -0.022321533,
      0.026132526,
      0.04078473,
      0.0115217455,
      -0.0074148676,
      -0.017480861,
      -0.006426613,
      -0.03709209,
      0.023161845,
      0.028594285,
      0.00358908,
      -0.03337578,
      0.0014505741,
      -0.06779307,
      0.012036584,
      -0.027860492,
      -0.003568368,
      0.006752086,
      -0.018037124,
      -0.045258503,
      -0.022345204,
      -0.020759262,
      0.009835203,
      -0.016569536,
      -0.02625088,
      -0.0029440515,
      0.0063496833,
      -0.022215014,
      -0.0013832604,
      -0.018830094,
      0.0000015169863,
      0.03976689,
      -0.02965947,
      -0.05931894,
      0.0444537,
      -0.020806603,
      -0.021575904,
      -0.016794408,
      0.02994352,
      -0.07550974,
      -0.03458299,
      -0.01919699,
      0.016865421,
      -0.031008704,
      0.02499633,
      -0.03747082,
      0.0014261637,
      -0.0030416935,
      -0.024037663,
      0.0060893046,
      0.044666737,
      -0.076361895,
      0.029730482,
      0.030677313,
      -0.008349863,
      0.015599035,
      -0.013729044,
      -0.0077995174,
      0.0078942,
      -0.012308799,
      0.035506148,
      -0.015303151,
      -0.03429894,
      0.014735052,
      0.03176617,
      -0.03704475,
      -0.010083746,
      0.064526506,
      0.0042489027,
      0.009450553,
      0.0032961543,
      -0.02504367,
      -0.05718857,
      -0.01117852,
      -0.07087027,
      0.011160767,
      0.019753255,
      -0.05221771,
      -0.034085903,
      0.025588099,
      0.05131822,
      0.024144182,
      -0.041826244,
      -0.008817361,
      -0.0077166697,
      -0.018747248,
      -0.0054235645,
      -0.008006637,
      0.015930425,
      0.0067816745,
      0.0053969347,
      -0.020984134,
      -0.007840942,
      -0.026984673,
      0.013516008,
      0.054016687,
      0.033115402,
      0.027055686,
      -0.00740895,
      -0.0005758654,
      0.0028094242,
      -0.0028390125,
      0.0132793,
      0.037873227,
      -0.013220123,
      0.022948807,
      -0.0044826516,
      0.008438628,
      -0.014095942,
      0.00008386478,
      -0.014770558,
      -0.0019513587,
      -0.030203898,
      0.01825016,
      -0.015007266,
      -0.017255988,
      0.04698647,
      -0.039979924,
      0.017173141,
      -0.015172961,
      -0.029399091,
      -0.043057125,
      -0.030393263,
      -0.01251,
      0.015930425,
      0.0090540685,
      -0.011569087,
      0.031103387,
      0.017693898,
      0.0117407,
      0.024238864,
      0.043767247,
      0.025801135,
      -0.0280972,
      -0.015575364,
      0.025422404,
      -0.015101949,
      0.008343945,
      0.019575724,
      -0.017835923,
      -0.009580743,
      -0.09615065,
      0.046868116,
      0.02284229,
      -0.030416934,
      0.038701702,
      -0.012557342,
      0.010018651,
      0.03280768,
      -0.03460666,
      0.025990501,
      0.032547303,
      -0.02812087,
      -0.04424066,
      0.01888927,
      -0.047743935,
      0.011823548,
      -0.013018921,
      0.014806064,
      -0.011989243,
      -0.044643067,
      -0.052880492,
      -0.042110294,
      0.0047696596,
      -0.014699546,
      0.054206055,
      -0.0063260123,
      0.04443003,
      -0.01638017,
      0.0049412725,
      0.017895099,
      -0.0072432547,
      0.0010385548,
      -0.038512338,
      -0.01638017,
      0.0108234575,
      0.010367796,
      -0.025114683,
      0.020510718,
      0.04601597,
      -0.04232333,
      -0.006450284,
      -0.08071731,
      0.0012582492,
      0.030700983,
      -0.018877435,
      -0.027671127,
      -0.03332844,
      0.0037814048,
      -0.024593927,
      0.007385279,
      0.036050577,
      0.028026188,
      0.023528742,
      0.03190819,
      0.005680984,
      0.03148212,
      -0.00948606,
      -0.026156196,
      -0.021717928,
      -0.044003956,
      0.066940926,
      -0.015812071,
      -0.017279658,
      0.03858335,
      0.041281816,
      0.017232317,
      0.048312034,
      -0.002668879,
      -0.018143643,
      0.04563724,
      -0.035198428,
      0.0450218,
      -0.010793869,
      -0.02178894,
      0.046868116,
      0.024108676,
      0.016238146,
      -0.048951145,
      -0.04755457,
      -0.02847593,
      0.015208467,
      0.059460964,
      0.03058263,
      -0.036902726,
      0.0104506435,
      0.034393623,
      -0.025824806,
      0.015965931,
      0.029233396,
      0.0058289263,
      -0.027434418,
      0.017327001,
      0.0057224077,
      -0.014155118,
      -0.00479333,
      0.0052549103,
      -0.0066218968,
      -0.02181261,
      -0.0050596264,
      -0.018179148,
      0.038180947,
      0.01266386,
      0.007077559,
      -0.029162385,
      -0.030322252,
      -0.006195823,
      -0.017398013,
      -0.011758453,
      0.011302791,
      0.041920926,
      0.050466076,
      -0.04296244,
      -0.033257425,
      0.0013640278,
      0.015184796,
      -0.08564083,
      0.009645837,
      -0.02530405,
      0.0057460787,
      0.0050211614,
      -0.041021436,
      -0.015551694,
      0.024522914,
      0.013847399,
      0.045305848,
      -0.026416576,
      -0.052407075,
      -0.00063282315,
      0.015303151,
      0.03268933,
      0.023658931,
      -0.035435136,
      -0.026771637,
      -0.0148415705,
      0.0071189827,
      0.010675516,
      0.055247568,
      0.014616698,
      0.0050182026,
      -0.023777286,
      -0.039388154,
      -0.016297322,
      0.03706842,
      0.012900568,
      0.019670406,
      -0.031647816,
      -0.04357788,
      0.024806963,
      -0.02781315,
      -0.02145755,
      0.0009830765,
      0.015717389,
      -0.052312393,
      -0.010107418,
      0.010918141,
      0.0034973556,
      -0.05316454,
      -0.017327001,
      0.022215014,
      0.02781315,
      0.0072195837,
      -0.028381249,
      0.0007700396,
      0.041163463,
      0.06978142,
      0.0155398585,
      -0.0043435856,
      -0.02845226,
      -0.0025238954,
      0.030203898,
      0.02930441,
      -0.048122667,
      0.035032734,
      0.03212123,
      0.030061873,
      -0.010426973,
      0.035411466,
      0.033778183,
      0.0061484817,
      -0.017954277,
      -0.041329157,
      0.0332811,
      0.0020371652,
      -0.00505075,
      -0.004026989,
      -0.01945737,
      -0.027884163,
      0.011296873,
      0.012486329,
      0.04504547,
      0.020416036,
      0.029115042,
      0.020285847,
      -0.0035210266,
      -0.06907129,
      0.026132526,
      0.0047223177,
      -0.010350043,
      0.017551873,
      -0.016463017,
      -0.0388674,
      -0.008456381,
      -0.008361698,
      0.023221022,
      0.019220661,
      0.0012841391,
      0.027718468,
      0.019978127,
      0.018214654,
      0.03917512,
      -0.013882904,
      -0.01978876,
      0.017267823,
      -0.0030742409,
      0.034464635,
      -0.008006637,
      0.026037842,
      0.004911684,
      0.0020963422,
      -0.035127416,
      -0.0023522824,
      0.0450218,
      -0.014249802,
      -0.021907294,
      -0.03777854,
      0.018522374,
      -0.019516546,
      -0.0077817645,
      0.0041483017,
      -0.027884163,
      0.0010577873,
      -0.04416965,
      -0.04042967,
      -0.005544877,
      -0.023753613,
      0.012770378,
      -0.040903084,
      -0.008947549,
      -0.03119807,
      0.042844087,
      0.027410747,
      0.005314087,
      -0.0082788505,
      -0.004740071,
      -0.0025194571,
      0.014829735,
      0.0014993951,
      -0.011995161,
      -0.021410208,
      -0.000018804853,
      -0.004831795,
      -0.031434778,
      -0.013208288,
      0.020806603,
      0.0056898603,
      0.025398733,
      0.018202819,
      -0.028026188,
      0.039411824,
      0.0139894225,
      -0.01253367,
      -0.007811353,
      0.022641089,
      0.018747248,
      0.008438628,
      0.02130369,
      0.016143462,
      -0.0036097919,
      0.04050068,
      0.034748685,
      -0.0016687891,
      -0.008420875,
      -0.018167313,
      0.002012015,
      0.02240438,
      0.0058437204,
      -0.031056045,
      -0.028641628,
      0.016865421,
      0.019694077,
      -0.016723396,
      -0.048075326,
      -0.054016687,
      0.03129275,
      -0.0041127955,
      -0.011184437,
      -0.04606331,
      -0.009941722,
      -0.06651485,
      -0.0075746453,
      0.03330477,
      -0.013918411,
      -0.007752176,
      -0.02148122,
      0.025753794,
      -0.022061154,
      -0.020167492,
      -0.027505431,
      -0.0377312,
      0.023576083,
      -0.047933303,
      0.000048543563,
      -0.01914965,
      -0.03058263,
      -0.029612128,
      0.012450823,
      -0.02596683,
      0.025469745,
      -0.03183718,
      -0.018581552,
      -0.014557521,
      -0.007367526,
      -0.004677935,
      0.030464277,
      0.010273113,
      -0.059176914,
      -0.029777825,
      -0.010196183,
      -0.008296603,
      0.020392366,
      0.045897614,
      0.02532772,
      -0.02286596,
      -0.017445356,
      -0.0014764641,
      0.013871069,
      0.011503993,
      0.010290866,
      0.020131987,
      0.018699905,
      0.0014897789,
      -0.048998486,
      -0.024641268,
      -0.016924597,
      0.0011354571,
      0.019256169,
      0.021682423,
      -0.007734423,
      -0.029470105,
      -0.038488667,
      0.003722228,
      0.004846589,
      -0.014036764,
      -0.009693178,
      0.015989603,
      0.005544877,
      0.034843367,
      -0.012403482,
      0.015125619,
      0.036595006,
      -0.0039145527,
      0.035458807,
      0.020451542,
      -0.006201741,
      0.015243974,
      0.0015415587,
      0.021339197,
      0.014178789,
      -0.006829016,
      0.049945317,
      0.011498075,
      -0.040619034,
      0.004393886,
      -0.027363406,
      0.021197172,
      -0.022570075,
      0.009616249,
      0.0155871995,
      -0.007136736,
      0.016806245,
      0.018119972,
      -0.0022694347,
      -0.013137275,
      -0.004195643,
      0.04012195,
      0.020475212,
      0.02301982,
      -0.01110159,
      -0.004603964,
      -0.014936253,
      -0.00008428087,
      0.01453385,
      0.0037695696,
      0.009533402,
      0.035553493,
      0.016060615,
      -0.049377218,
      -0.026487587,
      -0.004935355,
      0.0022620377,
      0.008568818,
      -0.031671487,
      0.004275532,
      -0.010568997,
      0.015243974,
      0.01112526,
      0.0064384486,
      0.014711381,
      -0.017019281,
      -0.0030076667,
      0.004568458,
      -0.00648579,
      0.03183718,
      -0.0321449,
      -0.014320814,
      0.058561474,
      -0.030535288,
      -0.020782933,
      -0.053022515,
      -0.031079717,
      -0.051412903,
      -0.008669418,
      0.0005414688,
      -0.004183808,
      0.003355331,
      -0.009184257,
      -0.019836102,
      0.0018640729,
      -0.012119432,
      -0.03205022,
      0.018853765,
      -0.028902005,
      -0.010983235,
      -0.042560037,
      0.019054966,
      0.0025815929,
      -0.036950067,
      0.01117852,
      0.005506412,
      -0.020155657,
      0.0067461682,
      -0.05770933,
      -0.008793689,
      0.027292393,
      0.00802439,
      0.022061154,
      0.036074247,
      0.026747966,
      -0.018640729,
      -0.0061425637,
      -0.020297682,
      -0.02191913,
      -0.026629612,
      -0.043175478,
      -0.014948089,
      0.014214295,
      -0.047980644,
      0.005775667,
      -0.025706451,
      -0.024061333,
      0.0060715517,
      -0.02563544,
      -0.029919848,
      0.0321449,
      -0.008645748,
      0.008077649,
      -0.0020164533,
      0.00054109894,
      0.018190984,
      -0.047601912,
      -0.011545416,
      0.04450104,
      0.026321892,
      -0.017942442,
      -0.010598586,
      0.01407227,
      -0.0024440065,
      0.014782393,
      -0.006775757,
      -0.0118472185,
      -0.025114683,
      -0.009207928,
      0.018877435,
      0.011823548,
      0.042252317,
      0.011308708,
      0.010302701,
      0.0016643507,
      0.005621807,
      0.017634721,
      -0.01594226,
      0.01681808,
      -0.04532952,
      -0.007959295,
      0.054111373,
      0.0021806695,
      0.025777465,
      0.012628354,
      -0.020084646,
      -0.03089035,
      0.015196632,
      0.017386178,
      0.018830094,
      0.017693898,
      0.013066263,
      -0.04140017,
      0.01994262,
      0.00502412,
      0.0055389595,
      -0.020652743,
      -0.013113605,
      -0.03122174,
      0.03266566,
      0.010941812,
      0.03361249,
      0.0030047079,
      0.004624676,
      0.0029869548,
      0.0332811,
      0.01563454,
      -0.044927113,
      0.010077829,
      -0.02996719,
      -0.00133296,
      0.0011798397,
      -0.012249622,
      -0.006432531,
      0.042062953,
      0.036689688,
      -0.00994764,
      -0.055389594,
      0.0017028158,
      0.0115217455,
      0.0014010135,
      0.019705912,
      -0.00463947,
      -0.000029680921,
      -0.00067942496,
      -0.0058259675,
      -0.008385369,
      0.033801854,
      0.013811892,
      -0.018676234,
      -0.008675336,
      -0.023753613,
      0.014746888,
      0.040642705,
      -0.016415676,
      0.019244334,
      0.018546045,
      -0.026771637,
      -0.015350492,
      -0.008373533,
      0.028310236,
      0.0058407616,
      -0.013871069,
      0.017622886,
      -0.018486869,
      0.015208467,
      0.01971775,
      0.007266925,
      0.00833211,
      -0.06054982,
      0.0129952505,
      -0.016877256,
      0.0088055255,
      -0.07063357,
      0.023090832,
      0.021102488,
      -0.020131987,
      0.057330597,
      -0.010054158,
      -0.024333548,
      -0.017054787,
      -0.000046925445,
      0.02317368,
      -0.0039263885,
      0.00797113,
      -0.021694258,
      0.03981423,
      0.007823188,
      0.0005096612,
      0.009059986,
      0.034961723,
      -0.016924597,
      0.02840492,
      0.016261816,
      -0.027529102,
      -0.01143298,
      0.005873309,
      0.003935265,
      0.052359734,
      0.0081072375,
      0.008651665,
      0.00374294,
      0.031955533,
      0.011776206,
      0.0016613919,
      -0.035103746,
      -0.015220303,
      -0.028310236,
      0.053969346,
      0.046820775,
      0.005627725,
      0.02440456,
      -0.0062254113,
      0.017433519,
      -0.012758543,
      -0.0026910703,
      0.017090293,
      0.024688609,
      0.055152886,
      -0.0055389595,
      0.01919699,
      -0.012012914,
      -0.033588815,
      0.0048051653,
      0.008432711,
      -0.03458299,
      0.023812791,
      0.050513417,
      -0.0056366012,
      0.0034500142,
      0.039009422,
      0.007556892,
      -0.00748588,
      0.001184278,
      -0.009622167,
      0.037825886,
      0.0075450568,
      -0.015255809,
      0.008580653,
      0.0039678123,
      -0.011681523,
      -0.02568278,
      0.0010629654,
      0.0022206136,
      -0.014439167,
      0.015101949,
      -0.02899669,
      -0.015409669,
      0.017031116,
      0.061354626,
      -0.002340447,
      0.014794229,
      0.008515558,
      -0.028854664,
      0.059745014,
      0.059129573,
      -0.013800057,
      -0.0029544076,
      0.009776026,
      -0.010711022,
      0.004092084,
      0.011634181,
      0.012042502,
      -0.012285127,
      0.0071308184,
      0.023871968,
      0.009089574,
      0.017540038,
      -0.007479962,
      0.012249622,
      -0.036642347,
      -0.00026796048,
      -0.02591949,
      -0.020629073,
      0.033801854,
      0.017078457,
      0.007189995,
      -0.05041873,
      0.026156196,
      -0.002122972,
      -0.0035594914,
      0.00266592,
      -0.016711561,
      -0.025398733,
      -0.029919848,
      0.026700625,
      0.05808806,
      -0.0029203808,
      -0.010787952,
      0.044927113,
      -0.011870889,
      -0.0036600921,
      0.0013862193,
      0.005311128,
      -0.008858784,
      0.00003855746,
      0.012711202,
      -0.022605581,
      0.010983235,
      0.03796791,
      0.014758723,
      0.03249996,
      0.056762498,
      0.065662704,
      0.0071485713,
      -0.030487947,
      0.004911684,
      0.019220661,
      0.028523274,
      -0.006811263,
      -0.026700625,
      0.012959745,
      -0.003683763,
      -0.00081294286,
      -0.042536367,
      -0.030085543,
      0.03825196,
      0.036263615,
      0.05652579,
      0.009438718,
      0.022593746,
      -0.05075012,
      -0.024570255,
      0.044974457,
      0.026487587,
      -0.017528202,
      0.003778446,
      0.0315768,
      0.0342516,
      -0.024806963,
      0.023244692,
      -0.013160946,
      -0.013930246,
      0.0097050145,
      -0.039364483,
      0.030369593,
      -0.009906216,
      -0.013480501,
      -0.001497176,
      0.031150728,
      0.01888927,
      -0.0016377211,
      -0.00817825,
      0.0033257427,
      0.020368695,
      0.010178429,
      0.0030446523,
      0.018285668,
      -0.009941722,
      0.0062609175,
      0.02345773,
      0.00974052,
      -0.009077739,
      -0.02563544,
      0.00787053,
      -0.041021436,
      0.038725372,
      -0.0321449,
      -0.07243255,
      0.006420695,
      0.02530405,
      0.006811263,
      -0.008864702,
      -0.027292393,
      -0.016652385,
      -0.03247629,
      -0.006056757,
      0.0051276796,
      0.010912223,
      -0.0062609175,
      0.015977766,
      -0.00018640728,
      -0.0018551963,
      -0.018001618,
      -0.0043317503,
      0.033517804,
      -0.039388154,
      0.007805435,
      0.0018907024,
      -0.022925137,
      -0.02268843,
      0.0029129838,
      0.015847579,
      0.041139793,
      0.014983595,
      0.035198428,
      0.014368155,
      -0.0013196452,
      -0.0048406716,
      0.029777825,
      -0.027907833,
      0.0059236092,
      0.029138714,
      0.039009422,
      0.00085806526,
      -0.006450284,
      -0.019362686,
      -0.048288364,
      0.022167673,
      -0.0074326205,
      0.008710842,
      -0.026345562,
      0.06481056,
      -0.0077225873,
      -0.028973019,
      -0.024664938,
      -0.007515468,
      -0.001707254,
      -0.044974457,
      -0.004953108,
      -0.014131447,
      -0.006965123,
      -0.0010548285,
      0.0006468777,
      0.0019987004,
      0.018640729,
      -0.017184976,
      0.003302072,
      -0.0043435856,
      -0.0122969635,
      0.0112732025,
      0.0069532874,
      0.00043125177,
      0.005914733,
      -0.006213576,
      0.0004693469,
      -0.02847593,
      -0.003568368,
      -0.0019469205,
      -0.008687171,
      0.032310598,
      0.04042967,
      0.017007446,
      -0.014652205,
      -0.0021348072,
      0.042583708,
      0.015279479,
      0.017634721,
      0.035884883,
      -0.011143013,
      0.0024395683,
      0.0079060355,
      0.011959654,
      0.0015371204,
      0.020108316,
      0.005337758,
      -0.0067461682,
      -0.027907833,
      0.022321533,
      -0.011533581,
      0.00671658,
      -0.022605581,
      -0.00997131,
      -0.047933303,
      -0.0051158443,
      0.032547303,
      -0.01956389,
      0.00148682,
      0.004092084,
      -0.060644504,
      0.04050068,
      0.011119342,
      -0.0043199146,
      0.016309159,
      -0.004456022,
      -0.026345562,
      -0.03332844,
      -0.01714947,
      0.046820775,
      0.01253367,
      0.011569087,
      0.0047903713,
      0.024972659,
      -0.006580473,
      0.008468216,
      -0.022084825,
      0.0342516,
      0.06731966,
      0.023374882,
      0.053922005,
      -0.019646736,
      -0.042536367,
      0.0019202909,
      -0.0122969635,
      0.039080434,
      -0.016723396,
      0.024759622,
      -0.009929886,
      -0.0336835,
      -0.008284768,
      0.03986157,
      -0.028570615,
      0.0017619927,
      -0.010373713,
      0.004532952,
      -0.00794746,
      0.022475393,
      0.0056099715,
      0.015232138,
      -0.022309696,
      0.015705554,
      -0.00948606,
      0.05965033,
      -0.025517086,
      -0.021209007,
      -0.026061514,
      0.041849915,
      0.0006073031,
      -0.0051927743,
      0.010722857,
      0.0015104908,
      0.0046897708,
      -0.0011805794,
      0.032002877,
      0.003985565,
      -0.034843367,
      -0.014143283,
      0.004926478,
      -0.0004142384,
      0.05093949,
      -0.00010291235,
      -0.0003876088,
      0.005068503,
      -0.03955385,
      0.029115042,
      -0.014166954,
      -0.047081154,
      -0.010669598,
      -0.014462838,
      -0.018759083,
      -0.026369235,
      0.020439707,
      -0.0055951774,
      0.013859234,
      -0.004571417,
      -0.007136736,
      0.012024749,
      0.006278671,
      0.020806603,
      0.017054787,
      0.00997131,
      -0.042252317,
      0.031340096,
      0.03917512,
      -0.017599214,
      0.008545146,
      0.0015992562,
      -0.024002157,
      -0.0014742449,
      0.020487048,
      -0.0110720005,
      0.012604683,
      0.005355511,
      0.03775487,
      -0.02842859,
      -0.0074681267,
      -0.0008491887,
      0.01268753,
      0.0049560666,
      0.021753434,
      0.04532952,
      -0.0028049857,
      -0.015101949,
      0.0025727164,
      0.019824266,
      -0.0336835,
      -0.014853406,
      0.003334619,
      0.016297322,
      0.008710842,
      -0.06561536,
      -0.01904313,
      -0.0049560666,
      -0.0047519063,
      0.02471228,
      0.012936073,
      0.00032824694,
      -0.012379811,
      -0.01822649,
      -0.020984134,
      0.03394388,
      -0.023161845,
      0.011864971,
      -0.020735592,
      -0.015883084,
      0.034535646,
      -0.0077166697,
      -0.004701606,
      -0.020984134,
      -0.01917332,
      0.01453385,
      -0.000011373064,
      -0.008870619,
      -0.0031097468,
      -0.0022058196,
      0.02622721,
      -0.0016687891,
      -0.00090540684,
      0.003997401,
      -0.011083837,
      0.006829016,
      -0.0296358,
      0.000815162,
      -0.012332469,
      -0.0014165475,
      0.003009146,
      -0.0027413706,
      -0.013776386,
      -0.022345204,
      0.013871069,
      -0.014924418,
      -0.0037814048,
      0.012178609,
      0.04260738,
      0.00061617966,
      0.0051483917,
      -0.008296603,
      -0.007616069,
      -0.019386357,
      -0.0004604704,
      -0.007959295,
      0.0067935097,
      0.04360155,
      0.018427692,
      0.021339197,
      -0.0024454861,
      0.023197351,
      0.0066278144,
      -0.032239582,
      -0.007835024,
      -0.0004745249,
      0.0018448404,
      -0.03297338,
      0.00004130826,
      -0.008598406,
      -0.0045921286,
      -0.014439167,
      -0.03957752,
      0.044690408,
      0.00044308716,
      -0.0064739548,
      -0.032002877,
      -0.008071731,
      -0.009030397,
      -0.007367526,
      0.029280737,
      -0.012450823,
      -0.0067224978,
      -0.009397294,
      0.032263253,
      -0.028262895,
      0.024025828,
      0.0038346641,
      -0.014983595,
      -0.0011066083,
      -0.014391826,
      0.043175478,
      -0.015812071,
      0.00328136,
      0.010480232,
      0.0060390043,
      -0.034038562,
      0.027529102,
      0.027552772,
      0.022084825,
      0.005846679,
      -0.0014387388,
      -0.030748324,
      -0.015267644,
      -0.019031296,
      -0.009728685,
      0.020664578,
      0.028546944,
      -0.031671487,
      0.010634092,
      0.014877076,
      -0.004991573,
      0.0062964237,
      0.041116122,
      -0.0010452123,
      -0.0009697617,
      0.011906396,
      0.05657313,
      0.03276034,
      -0.0031304588,
      0.0076397397,
      0.010332289,
      0.005488659,
      -0.0043820506,
      -0.035553493,
      0.0035920388,
      -0.05685718,
      -0.005003408,
      -0.03306806,
      0.0469628,
      0.01714947,
      0.010912223,
      -0.012592847,
      0.0046838527,
      0.01253367,
      0.03238161,
      -0.0015933384,
      0.021670587,
      -0.0011953737,
      -0.005467947,
      0.022700265,
      0.004393886,
      -0.014285307,
      -0.0027842738,
      -0.030914022,
      -0.025493415,
      -0.014084106,
      0.016119791,
      -0.030038202,
      0.018037124,
      -0.018569715,
      0.0077403407,
      0.011450733,
      -0.044359017,
      0.0063378476,
      0.004544787,
      -0.030937692,
      0.0049974904,
      0.00073712243,
      -0.00035358206,
      0.0039145527,
      -0.0039766887,
      -0.03953018,
      0.00633193,
      0.037518166,
      0.037494496,
      -0.023540577,
      -0.0023759531,
      0.00710123,
      -0.014332649,
      0.018001618,
      -0.022877796,
      0.01838035,
      -0.01150991,
      -0.0042873677,
      -0.009965393,
      0.0027783562,
      -0.047057483,
      0.008136826,
      0.0026614817,
      -0.007006547,
      0.009574825,
      -0.026889991,
      -0.0056070127,
      0.021398373,
      -0.044927113,
      -0.048572414,
      -0.0010533491,
      0.035695516,
      -0.045921285,
      0.006136646,
      0.00018936612,
      -0.01563454,
      0.021137994,
      0.024357218,
      -0.019540217,
      -0.011527663,
      0.047767606,
      0.013078098,
      -0.031955533,
      -0.018048959,
      -0.047696594,
      0.010557162,
      0.013208288,
      -0.0067402506,
      -0.015409669,
      -0.010196183,
      0.017327001,
      0.02502,
      0.015326821,
      0.03209756,
      0.0061425637,
      0.020285847,
      0.032239582,
      0.018948449,
      -0.018001618,
      -0.024854304,
      0.013267465,
      -0.015622706,
      -0.01133238,
      -0.012711202,
      -0.009491977,
      0.0055922186,
      0.012474494,
      0.021433879,
      0.01868807,
      -0.012427152,
      -0.022155838,
      -0.011734783,
      0.008450463,
      0.0026703584,
      0.0082788505,
      0.012853226,
      0.03186085,
      0.034796026,
      -0.03616893,
      0.032926034,
      -0.032878693,
      0.028830994,
      -0.018924778,
      0.075131014,
      0.035293113,
      -0.03238161,
      0.008184168,
      0.0015008745,
      0.020593567,
      0.002053439,
      0.03552982,
      0.018936614,
      -0.02238071,
      0.010716939,
      -0.041731562,
      -0.0129952505,
      0.023434058,
      0.0021288896,
      -0.047199506,
      -0.009367705,
      0.047175836,
      0.0013129878,
      0.015184796,
      0.030771997,
      0.007367526,
      -0.030795667,
      -0.012178609,
      0.020238506,
      0.020356858,
      -0.018498704,
      0.0040181126,
      -0.016119791,
      0.006278671,
      -0.0120484205,
      -0.03976689,
      0.017658392,
      -0.02297248,
      0.007521386,
      -0.0007737382,
      -0.029162385,
      0.002850848,
      0.0016318035,
      -0.034725014,
      0.006278671,
      -0.003260648,
      0.027623784,
      -0.021078818,
      -0.023647096,
      -0.03863069,
      -0.005201651,
      0.047909632,
      0.02130369,
      -0.012143103,
      -0.017315166,
      -0.0025756753
    ]; // replace with your query vector
    const collectionName = "catalog";
    const collection = client.db("ecommerce").collection(collectionName);
    const pipeline = [
      {
        $vectorSearch: {
          index: "vector_index", 
          //path: "vector", 
          path: "description_embedding", 
          queryVector:queryVector, 
          numCandidates: 3, 
          limit: 2
        }
      }, {
        '$project': {
          _id: 0, 
          title: 1, 
          description: 1, 
          score: {
            $meta: "vectorSearchScore"
          }
        }
      }
    ];

    const result = await collection.aggregate(pipeline).toArray();

    res.json(result);

  } catch (err) {
    res.status(500).json({ message: err.message });
  }
});


app.get('/vectorize', async (req, res) => {
  const collectionName = "catalog";
  const collection = client.db("ecommerce").collection(collectionName);

  const cursor = collection.find({});
  while (await cursor.hasNext()) {
      const doc = await cursor.next();
      const vector = await createVector(doc.description); // replace with your field
      await collection.updateOne({ _id: doc._id }, { $set: { description_embedding: vector } });
  }

  res.send('Vectorization completed');
});

async function createVector(data) {
  const response = await openai.embeddings.create({
      model: "text-embedding-3-small",
      input: data,
      encoding_format: "float"
  });

  return response.data[0].embedding;
}

//TODO: busqueda abuelita
//TODO: image search
//TODO: image search
app.get('/image-search', async (req, res) => {
  const vector = req.query.q;
  try {
    const queryVector = [
      0.00762516213580966,
            0.022779108956456184,
            0.00457530003041029,
            0.03645492345094681,
            0.01979535073041916,
            0.004703411366790533,
            -0.017102031037211418,
            0.02868213877081871,
            0.018207300454378128,
            0.07047122716903687,
            -0.030641958117485046,
            -0.023836780339479446,
            0.02670235186815262,
            -0.09142716974020004,
            0.00754923140630126,
            -0.009201995097100735,
            0.05407009646296501,
            0.046181946992874146,
            0.04879080131649971,
            -0.08261266350746155,
            0.040045998990535736,
            -0.006601665634661913,
            0.03617049753665924,
            0.012210126966238022,
            -0.007895742543041706,
            -0.0033329420257359743,
            -0.0009499392472207546,
            -0.018385889008641243,
            -0.04727042093873024,
            -0.007235703524202108,
            6.0304988437565044e-05,
            0.05623645335435867,
            -0.006919084116816521,
            0.015346427448093891,
            -0.02709527686238289,
            -0.036269038915634155,
            -0.05200493708252907,
            -0.05908855050802231,
            -0.023540420457720757,
            0.035505831241607666,
            -0.019232744351029396,
            0.036375172436237335,
            0.034273069351911545,
            -0.044954102486371994,
            0.03473297879099846,
            -0.06188663840293884,
            0.0015715184854343534,
            0.06196669489145279,
            0.022554028779268265,
            -0.10482793301343918,
            -0.012787356041371822,
            -0.04061707854270935,
            0.020468808710575104,
            -0.024973850697278976,
            -0.008849944919347763,
            -0.0016574510373175144,
            0.021522749215364456,
            -0.057303234934806824,
            0.03643041476607323,
            -0.0038111095782369375,
            -0.00549332145601511,
            -0.05419256538152695,
            -0.02817194163799286,
            -0.010343609377741814,
            -0.05387873947620392,
            -0.0183855090290308,
            -0.0031420551240444183,
            -0.07189971208572388,
            -0.042098864912986755,
            -0.026171080768108368,
            -0.02802751213312149,
            0.011139816604554653,
            -0.04976892098784447,
            0.04537581652402878,
            -0.004379886202514172,
            -0.024038398638367653,
            -0.010971996933221817,
            -0.012286944314837456,
            0.03407156094908714,
            0.05005725100636482,
            0.019498096778988838,
            0.03291916474699974,
            -0.017742011696100235,
            -0.00897388719022274,
            0.03408823907375336,
            -0.039639897644519806,
            0.1453518122434616,
            0.03552503138780594,
            -0.038299065083265305,
            0.07149064540863037,
            0.05339634791016579,
            0.011035529896616936,
            -0.43719133734703064,
            -0.04646563529968262,
            -0.012522752396762371,
            -0.02885046973824501,
            -0.01384322065860033,
            0.032301731407642365,
            0.0031465517822653055,
            -0.0003851920773740858,
            0.021490218117833138,
            -0.031317420303821564,
            0.0033163961488753557,
            0.007282336242496967,
            -0.014765867032110691,
            -0.006506779696792364,
            -0.26090943813323975,
            0.011353402398526669,
            0.017086045816540718,
            0.02345293015241623,
            0.02602890506386757,
            0.040365882217884064,
            0.0026451656594872475,
            -0.03700435161590576,
            0.0009064614423550665,
            0.016053490340709686,
            0.044186946004629135,
            0.013726269826292992,
            -0.0051797921769320965,
            0.03865620866417885,
            0.026431916281580925,
            0.026518747210502625,
            -0.01920025609433651,
            0.005721125286072493,
            0.024973852559924126,
            0.002784386510029435,
            -0.015070822089910507,
            0.0026532700285315514,
            -0.03622860834002495,
            -0.029919590801000595,
            0.03264118731021881,
            0.0681094154715538,
            -0.022532368078827858,
            0.07073751837015152,
            0.05873378738760948,
            -0.042659156024456024,
            0.009298834018409252,
            -0.00638204999268055,
            -0.032190416008234024,
            0.04667666554450989,
            -0.013925260864198208,
            -0.04261565953493118,
            -0.004621345549821854,
            -0.01206270232796669,
            -0.020680155605077744,
            0.057091765105724335,
            -0.0001495268224971369,
            0.03583588823676109,
            0.03393787145614624,
            -0.011899122968316078,
            0.03082532249391079,
            -0.004342509433627129,
            0.038373906165361404,
            0.0071667879819869995,
            -0.01611563190817833,
            0.009553774259984493,
            0.06229638680815697,
            0.04599925875663757,
            -0.04493265971541405,
            -0.00132805819157511,
            -0.028629781678318977,
            -0.017206311225891113,
            -0.04723207652568817,
            0.0663229450583458,
            0.041100047528743744,
            0.020432600751519203,
            -0.018176672980189323,
            -0.007862056605517864,
            0.07237344235181808,
            -0.002948520705103874,
            -0.005063727032393217,
            -0.05147743970155716,
            0.04801546782255173,
            0.022708188742399216,
            0.012021489441394806,
            -0.028323469683527946,
            0.02509371191263199,
            -0.010266469791531563,
            0.008600590750575066,
            0.06232868507504463,
            0.03138231113553047,
            -0.03805341199040413,
            -0.008374619297683239,
            -0.005021550226956606,
            0.019868435338139534,
            -0.03526278957724571,
            -0.03930143266916275,
            -0.051393501460552216,
            0.003716184990480542,
            -0.008634014055132866,
            -0.0009331600740551949,
            0.022586116567254066,
            0.013380290009081364,
            0.014360090717673302,
            0.08371623605489731,
            -0.01237606629729271,
            -0.004170711152255535,
            -0.022567572072148323,
            0.06651372462511063,
            -0.03477219119668007,
            0.06016477197408676,
            -0.08363163471221924,
            -0.01643185317516327,
            0.044730231165885925,
            -0.02953651174902916,
            -0.029397333040833473,
            -0.027806002646684647,
            -0.028286276385188103,
            0.059199824929237366,
            0.005704166367650032,
            0.01699645072221756,
            0.0033886400051414967,
            0.02975320629775524,
            -0.025795716792345047,
            -0.04465081915259361,
            -0.004727364517748356,
            -0.0218105036765337,
            -0.02175047993659973,
            0.03867670148611069,
            -0.03029341623187065,
            0.026700332760810852,
            -0.09533960372209549,
            0.006976714823395014,
            -0.04451611265540123,
            -0.03150136396288872,
            0.0012177160242572427,
            0.012288386933505535,
            -0.0056624943390488625,
            0.047059912234544754,
            -0.05730719864368439,
            0.02194315753877163,
            0.013197977095842361,
            -0.031992699950933456,
            0.060333844274282455,
            0.015520426444709301,
            0.03117184340953827,
            0.033576205372810364,
            0.030016500502824783,
            -0.04951033368706703,
            -0.06640633195638657,
            0.0066901338286697865,
            -0.00999381486326456,
            -0.007031585555523634,
            -0.04461976885795593,
            0.004559341352432966,
            0.05486058071255684,
            -0.0037564628291875124,
            0.028478534892201424,
            -0.0022755307145416737,
            0.026787228882312775,
            -0.035735923796892166,
            -0.0607161708176136,
            -0.0484110563993454,
            -0.01709909923374653,
            0.04893728345632553,
            -0.0026739947497844696,
            0.0732111856341362,
            0.02010239288210869,
            -0.10297054797410965,
            -0.027356194332242012,
            0.011452355422079563,
            0.002608667826279998,
            -0.009565893560647964,
            -0.050195664167404175,
            0.03387758880853653,
            0.040644384920597076,
            0.030886288732290268,
            0.056133437901735306,
            -0.012297049164772034,
            -0.008515790104866028,
            -0.029944276437163353,
            0.018631331622600555,
            0.041336268186569214,
            0.007259106729179621,
            0.0068819825537502766,
            0.002275529783219099,
            -0.013669878244400024,
            -0.02259087935090065,
            -0.005206906236708164,
            -0.007186433300375938,
            0.019094116985797882,
            0.006776994559913874,
            0.03810419514775276,
            -0.007106132339686155,
            -0.008498968556523323,
            -0.0003388542390894145,
            0.13474978506565094,
            0.006605327595025301,
            0.01738564670085907,
            -0.037881433963775635,
            0.03673030436038971,
            0.06674730032682419,
            0.002823895774781704,
            -0.023679357022047043,
            -0.006654929835349321,
            -0.006126564461737871,
            0.03561101108789444,
            -0.0035992516204714775,
            0.06175096705555916,
            0.0013793112011626363,
            0.004883764777332544,
            -0.0345798097550869,
            0.05589013174176216,
            0.04018254950642586,
            0.015696579590439796,
            -0.024095900356769562,
            0.008690846152603626,
            -0.03712290897965431,
            0.07510466128587723,
            -0.004070050083100796,
            0.030617471784353256,
            0.005692996084690094,
            0.07073710858821869,
            -0.00790275726467371,
            0.011475102975964546,
            -0.012124359607696533,
            0.07098668813705444,
            0.012979654595255852,
            0.015457548201084137,
            0.03274441882967949,
            -0.00484706275165081,
            0.24123361706733704,
            -0.010423768311738968,
            0.03822428360581398,
            -0.021266045048832893,
            -0.04975726827979088,
            0.034017350524663925,
            -0.06564339250326157,
            -0.05498256906867027,
            -0.03663798049092293,
            -0.059659142047166824,
            0.05549502372741699,
            0.014340892434120178,
            -0.014277031645178795,
            -0.0174630805850029,
            0.030009808018803596,
            -0.02397744730114937,
            -0.009999084286391735,
            -0.002991118934005499,
            -0.05721578374505043,
            -0.03954475745558739,
            0.0492420569062233,
            0.038327135145664215,
            -0.020932413637638092,
            0.028101228177547455,
            -0.007078635506331921,
            0.013453390449285507,
            -0.0028674444183707237,
            -0.005650870501995087,
            -0.04070990905165672,
            -0.008575279265642166,
            0.02281559817492962,
            -0.019527927041053772,
            0.03626347705721855,
            -0.001697990344837308,
            -0.014451243914663792,
            -0.010652207769453526,
            0.02976241335272789,
            0.0010077767074108124,
            -0.06082891300320625,
            0.04191914573311806,
            -0.048161689192056656,
            0.000985141028650105,
            -0.0033864309079945087,
            -0.07820309698581696,
            -0.0018174530705437064,
            0.01214879471808672,
            0.010096889920532703,
            0.025423333048820496,
            0.032105620950460434,
            0.07044965773820877,
            -0.00023439912183675915,
            0.002708554733544588,
            -0.04224569350481033,
            -0.020095720887184143,
            -0.09064480662345886,
            0.00440563028678298,
            -0.03748432919383049,
            -0.0287865549325943,
            -0.0018659778870642185,
            0.030438987538218498,
            -0.013466689735651016,
            -0.016261374577879906,
            0.008152708411216736,
            0.019364062696695328,
            -0.04378961771726608,
            0.05431360751390457,
            -0.030725939199328423,
            -0.02022017352283001,
            0.0403730683028698,
            -0.023102283477783203,
            0.0014555529924109578,
            -0.011419974267482758,
            0.022147657349705696,
            -0.016597211360931396,
            -0.03219654783606529,
            0.005822364706546068,
            0.009382221847772598,
            0.013809080235660076,
            -0.019368063658475876,
            -0.020233096554875374,
            0.03304705396294594,
            0.021031493321061134,
            -0.012413810938596725,
            -0.002495380351319909,
            0.016654809936881065,
            -0.03588145226240158,
            -0.05126563459634781,
            0.001714728306978941,
            -0.037832070142030716,
            0.023972811177372932,
            0.01771589368581772,
            0.023828722536563873,
            0.031216248869895935,
            -0.008552396669983864,
            0.025921080261468887,
            0.021500496193766594,
            0.0002573405217844993,
            0.03324931859970093,
            -0.060056839138269424,
            -0.03337173908948898,
            0.013841957785189152,
            -0.0003214050375390798,
            -0.015200767666101456,
            0.0006999882170930505,
            -0.02284136973321438,
            -0.04242444410920143,
            0.027866356074810028,
            -0.2823110818862915,
            0.03719983622431755,
            -0.008893031626939774,
            -0.04822700470685959,
            0.031163616105914116,
            0.018065759912133217,
            -0.024162093177437782,
            0.02698797546327114,
            -0.0102547537535429,
            -0.002749161096289754,
            0.07319185882806778,
            0.04334824159741402,
            -0.020715203136205673,
            -0.005750393494963646,
            -0.004517478868365288,
            -0.04062391817569733,
            0.0008106634486466646,
            0.030820675194263458,
            -0.02837689407169819,
            -0.031660404056310654,
            0.04273311793804169,
            -0.03351584076881409,
            -0.0239255428314209,
            0.010439420118927956,
            0.027107886970043182,
            -0.01375032402575016,
            -0.010703851468861103,
            -0.03128098323941231,
            -0.019935550168156624,
            -0.02561296336352825,
            -0.005432055331766605,
            -0.03544371947646141,
            0.025587478652596474,
            -0.0010130386799573898,
            0.035248108208179474,
            0.03305633366107941,
            0.03340085595846176,
            0.041827909648418427,
            0.01135694608092308,
            -0.004666053224354982,
            0.017245925962924957,
            0.014365590177476406,
            0.0015147641533985734,
            -0.01706182025372982,
            0.042300689965486526,
            0.00863046944141388,
            -0.04372918978333473,
            0.0031505259685218334,
            0.003117233980447054,
            -0.02928651124238968,
            0.024984516203403473,
            0.004377450328320265,
            -0.07123341411352158,
            -0.04685709998011589,
            0.009147743694484234,
            -0.00646365899592638,
            -0.010457482188940048,
            0.06567788124084473,
            -0.028870828449726105,
            -0.031091909855604172,
            -0.008993198163807392,
            -0.005295324604958296,
            0.02799692377448082,
            0.01837584562599659,
            0.008481809869408607,
            0.021669991314411163,
            -0.016889644786715508,
            -0.08431031554937363,
            -0.0020831823348999023,
            0.015626000240445137,
            0.01313973031938076,
            -0.019753675907850266,
            -0.008520405739545822,
            -0.008102971129119396,
            0.006690219044685364,
            -0.026860343292355537,
            0.03610091656446457,
            -0.04611237347126007,
            -0.005149075761437416,
            -0.02530442550778389,
            -0.053568270057439804,
            0.0015866725007072091,
            0.049349140375852585,
            0.016466131433844566
    ]; // replace with your query vector
    const collectionName = "catalog";
    const collection = client.db("ecommerce").collection(collectionName);
    const pipeline = [
      {
        $vectorSearch: {
          index: "vector_imege3", 
          //path: "vector", 
          path: "image_embedding3", 
          queryVector:queryVector, 
          numCandidates: 3, 
          limit: 2
        }
      }, {
        '$project': {
          _id: 0, 
          title: 1, 
          description: 1, 
          image: 1,
          score: {
            $meta: "vectorSearchScore"
          }
        }
      }
    ];

    const result = await collection.aggregate(pipeline).toArray();

    res.json(result);

  } catch (err) {
    res.status(500).json({ message: err.message });
  }
});


const port = process.env.PORT;
console.log(port);

app.listen(5000, () => console.log('Server running on port ' + port));

